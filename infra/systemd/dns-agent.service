[Unit]
Description=AezaCheck DNS Agent
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User=aezacheck
Group=aezacheck
Environment="AGENT_CONTROL_PLANE=https://api-gw.example.com/v1/agents/"
EnvironmentFile=-/opt/aezacheck/agent/dns-agent.env
EnvironmentFile=/etc/aezacheck/dns-agent/secrets.env
ExecStart=/opt/aezacheck/agent/dns_agent
ExecStartPost=/opt/aezacheck/agent/bin/dns-agent-healthcheck.sh
Restart=always
RestartSec=5s
TimeoutStartSec=30s
TimeoutStopSec=20s
LimitNOFILE=65536
MemoryHigh=512M
AmbientCapabilities=CAP_NET_BIND_SERVICE
CapabilityBoundingSet=CAP_NET_BIND_SERVICE
NoNewPrivileges=yes
RuntimeDirectory=dns-agent
RuntimeDirectoryMode=0750
TasksMax=512

[Install]
WantedBy=multi-user.target
